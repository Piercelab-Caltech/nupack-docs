<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://piercelab-caltech.github.io/nupack-docs/other/">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Other - NUPACK 4.0 User Guide</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  <link href="../extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Other";
    var mkdocs_page_input_path = "other.md";
    var mkdocs_page_url = "/nupack-docs/other/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> NUPACK 4.0 User Guide</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Overview</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../definitions/">Definitions</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../model/">Model Specification</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../analysis/">Analysis Jobs</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../design/">Design Jobs</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../utilities/">Utilities Jobs</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../start/">Getting Started</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../advanced/">Advanced</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">NUPACK 4.0 User Guide</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Other</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <p>If <code>complexes</code> is not specified, all three defaults are used (i.e., the set of complexes is simply the set of strands).</p>
<p>Note that <code>ComplexSet</code> defines a set of complexes (all complexes of up to <code>max_size=3</code> strands) but omits optional concentrations for strands <code>a</code> and <code>b</code> since <code>complex_analysis</code> does not calculate equilibrium complex concentrations, and hence does not require concentration information for the strand species.</p>
<p>Multiple <code>Tube</code>s may be combined additively using the class method <code>union</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">Tube</span><span class="o">.</span><span class="n">union</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">])</span>
</code></pre></div>
<p>To obtain a <code>ComplexSet</code> taking a union of all complexes over a set of tubes, use the class method <code>union</code> of <code>ComplexSet</code>. The <code>Tube</code> class derives from <code>ComplexSet</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">ComplexSet</span><span class="o">.</span><span class="n">union</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">])</span>
</code></pre></div>
<p>Multiple <code>ComplexSet</code>s may be combined using the class method <code>union</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">my_complexes2</span> <span class="o">=</span> <span class="n">ComplexSet</span><span class="p">(</span><span class="n">strands</span><span class="o">=</span><span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">C</span><span class="p">],</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ComplexSet</span><span class="o">.</span><span class="n">union</span><span class="p">([</span><span class="n">my_complexes</span><span class="p">,</span> <span class="n">my_complexes2</span><span class="p">])</span>
</code></pre></div>
<h2 id="specifying-a-sequence">Specifying a sequence<a class="headerlink" href="#specifying-a-sequence" title="Permanent link">&para;</a></h2>
<p>A <code>Sequence</code> is specified by valid nucleotide letters, which can contain wildcards.  Run-length encoding may be used to specify repeats of a given nucleotide. <code>'U'</code> and <code>'T'</code>may be interchanged for printing purposes.</p>
<div class="highlight"><pre><span></span><code><span class="n">s1</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">(</span><span class="s1">&#39;AAAAAUUUUU&#39;</span><span class="p">)</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">(</span><span class="s1">&#39;A5T5&#39;</span><span class="p">)</span>
<span class="n">s3</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">(</span><span class="s1">&#39;A5U5&#39;</span><span class="p">)</span>

<span class="n">s1</span> <span class="o">==</span> <span class="n">s2</span> <span class="c1"># --&gt; True</span>
<span class="n">s1</span> <span class="o">==</span> <span class="n">s3</span> <span class="c1"># --&gt; True</span>
<span class="n">s3</span> <span class="c1"># --&gt; Sequence(&#39;AAAAAUUUUU&#39;)</span>
</code></pre></div>
<p>You can access the reverse complement of a <code>Sequence</code> using the following syntaxes:</p>
<div class="highlight"><pre><span></span><code><span class="n">s1</span><span class="o">.</span><span class="n">reverse_complement</span><span class="p">()</span> <span class="c1"># --&gt; Sequence(&#39;UUUUUAAAAA&#39;)</span>
<span class="o">~</span><span class="n">s1</span> <span class="c1"># --&gt; Sequence(&#39;UUUUUAAAAA&#39;)</span>
</code></pre></div>
<p>The <code>~a</code> syntax is generally recommended for brevity. Thus <code>~a</code> corresponds to the usual complement specification <code>a*</code> (unfortunately, the latter is not valid Python).</p>
<hr />
<h2 id="pairlist">PairList<a class="headerlink" href="#pairlist" title="Permanent link">&para;</a></h2>
<p>Under the hood, secondary structures are stored in NUPACK using the <code>PairList</code> object.
A pair list contains a list of zero-based indices <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> such that if <span><span class="MathJax_Preview">p_i = j</span><script type="math/tex">p_i = j</script></span>, bases <span><span class="MathJax_Preview">i</span><script type="math/tex">i</script></span> and <span><span class="MathJax_Preview">j</span><script type="math/tex">j</script></span> are paired, and if <span><span class="MathJax_Preview">p_i = i</span><script type="math/tex">p_i = i</script></span>, base <span><span class="MathJax_Preview">i</span><script type="math/tex">i</script></span> is unpaired.
Any secondary structure, including highly-nested pseudoknots, may be specified in this way.
(However, NUPACK 4 currently includes no functionality for analyzing pseudoknots.)</p>
<p>A <code>PairList</code> may be created using the following syntaxes in Python:</p>
<div class="highlight"><pre><span></span><code><span class="n">s1</span> <span class="o">=</span> <span class="n">PairList</span><span class="p">(</span><span class="s1">&#39;((((((((((((+..........))))))))))))&#39;</span><span class="p">)</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">PairList</span><span class="p">(</span><span class="s1">&#39;(12+.10)12&#39;</span><span class="p">)</span>
<span class="n">s3</span> <span class="o">=</span> <span class="n">PairList</span><span class="p">(</span><span class="s1">&#39;D12 (+ U10)&#39;</span><span class="p">)</span>
</code></pre></div>
<p>You can print a <code>PairList</code> to view its raw data:</p>
<div class="highlight"><pre><span></span><code><span class="n">s</span> <span class="o">=</span> <span class="n">PairList</span><span class="p">(</span><span class="s1">&#39;(...)&#39;</span><span class="p">)</span>

<span class="n">s</span>          <span class="c1"># --&gt; PairList([4, 1, 2, 3, 0])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>   <span class="c1"># --&gt; [4 1 2 3 0]</span>
</code></pre></div>
<p>Or you can access its data and calculating its corresponding structure matrix:</p>
<div class="highlight"><pre><span></span><code><span class="n">s</span><span class="o">.</span><span class="n">pairlist</span><span class="p">()</span>  <span class="c1"># --&gt; array([4, 1, 2, 3, 0], dtype=int32)</span>

<span class="n">s</span><span class="o">.</span><span class="n">matrix</span><span class="p">()</span> <span class="c1"># --&gt; array([[0, 0, 0, 0, 1],</span>
           <span class="c1">#            [0, 1, 0, 0, 0],</span>
           <span class="c1">#            [0, 0, 1, 0, 0],</span>
           <span class="c1">#            [0, 0, 0, 1, 0],</span>
           <span class="c1">#            [1, 0, 0, 0, 0]], dtype=int32)</span>
</code></pre></div>
<hr />
<h2 id="structure">Structure<a class="headerlink" href="#structure" title="Permanent link">&para;</a></h2>
<p>You might notice that the pair list specification does not include any information on structure nicks.
This can be inconvenient when printing a <code>PairList</code>.
As a result, NUPACK provides a <code>Structure</code> class, which inherits from <code>PairList</code> and adds a list of nick indices:</p>
<ol start="2">
<li><code>nicks</code>: a list of indices where each integer is the (zero-based) index of a base after a strand break</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="n">s</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">(</span><span class="s1">&#39;(((+)))&#39;</span><span class="p">)</span>
<span class="n">s</span>                      <span class="c1"># --&gt; Structure(&#39;(((+)))&#39;)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>               <span class="c1"># --&gt; (((+)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">pairlist</span><span class="p">())</span>       <span class="c1"># --&gt; [5 4 3 2 1 0]</span>
</code></pre></div>
<hr />
<h2 id="named-objects">Named objects<a class="headerlink" href="#named-objects" title="Permanent link">&para;</a></h2>
<p>The remaining core objects accept a first argument of <code>name</code> to be specified by the user.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The name may specified as a <code>tuple</code> or <code>list</code> instead of a <code>str</code>, in which case a <code>'[]'</code> based string will be automatically generated. This is specifically useful for repeated definitions:</p>
<div class="highlight"><pre><span></span><code><span class="n">domains</span> <span class="o">=</span> <span class="p">[</span><span class="n">Domain</span><span class="p">(</span><span class="s1">&#39;N6&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">([</span><span class="n">d</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">domains</span><span class="p">])</span> <span class="c1"># --&gt; [&#39;a[0]&#39;, &#39;a[1]&#39;, &#39;a[2]&#39;, &#39;a[3]&#39;]</span>
</code></pre></div>
</div>
<p>Note that for text formatting, the following behavior has been implemented on the following objects:</p>
<ul>
<li><code>str()</code> prints the value of the object</li>
<li><code>repr()</code> prints an expression which is equivalent to the one used to construct the object</li>
</ul>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><span class="n">s</span> <span class="o">=</span> <span class="n">Domain</span><span class="p">(</span><span class="s1">&#39;N6&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="c1"># --&gt; NNNNNN</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="c1"># --&gt; Domain(&#39;a&#39;, &#39;NNNNNN&#39;)</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In general, you should make every user-specified name unique. Uniqueness should hold across different classes of objects (<code>Domain</code>, <code>Strand</code>, etc.).</p>
</div>
<hr />
<h2 id="domain">Domain<a class="headerlink" href="#domain" title="Permanent link">&para;</a></h2>
<p>A domain is a fixed-length sequence of nucleotides, primarily useful in a design context. It reflects a shared sequence that may appear multiple times in different strands. A domain may be created from a name and <code>Sequence</code> (or sequence string).</p>
<div class="highlight"><pre><span></span><code><span class="n">a</span> <span class="o">=</span> <span class="n">Domain</span><span class="p">(</span><span class="s1">&#39;AUCGUAGCUA&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Domain</span><span class="p">(</span><span class="s1">&#39;AUAUSSSKKN&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="c1"># Wildcards are permitted</span>
</code></pre></div>
<p>You can access the reverse complement of a <code>Domain</code> as you would a <code>Sequence</code>, e.g. as <code>~a</code>. In design, the invariant is maintained that the currently specified sequence of <code>a</code> is reverse complement to that of <code>~a</code>.</p>
<p>You may access the sequence of a <code>Domain</code> by calling <code>str()</code> on it:</p>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="c1"># --&gt; &#39;AUCGUAGCUA&#39;</span>
</code></pre></div>
<p>A domain only compares equal to another one if they have the same sequence and name:</p>
<div class="highlight"><pre><span></span><code><span class="n">a1</span> <span class="o">=</span> <span class="n">Domain</span><span class="p">(</span><span class="s1">&#39;AUCGUAGCUA&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;a1&#39;</span><span class="p">)</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">Domain</span><span class="p">(</span><span class="s1">&#39;AUCGUAGCUA&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;a2&#39;</span><span class="p">)</span>

<span class="n">a1</span> <span class="o">==</span> <span class="n">a2</span> <span class="c1"># --&gt; False</span>
<span class="n">a1</span> <span class="o">==</span> <span class="n">a1</span> <span class="c1"># --&gt; True</span>
</code></pre></div>
<hr />
<h2 id="advanced-usage">Advanced usage<a class="headerlink" href="#advanced-usage" title="Permanent link">&para;</a></h2>
<p>NUPACK 4 also provides a more flexible and lower-level interface for thermodynamic analysis as well. To use this interface, first create an <code>Specification</code> object by specifying the secondary structure model to use:</p>
<div class="highlight"><pre><span></span><code><span class="n">spec</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">Specification</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">Model</span><span class="p">())</span>
</code></pre></div>
<hr />
<h2 id="queuing-calculations">Queuing calculations<a class="headerlink" href="#queuing-calculations" title="Permanent link">&para;</a></h2>
<p>Frequently, thermodynamic analysis can be sped up by computing quantities in aggregate, rather than one by one. For instance, caching may decrease the cost of analyzing complexes of up to <span><span class="MathJax_Preview">L</span><script type="math/tex">L</script></span> strands by up to a factor of <span><span class="MathJax_Preview">L-1</span><script type="math/tex">L-1</script></span>. Therefore, the analysis API encourages queueing of all of the calculations you want to perform before computation actually takes place.</p>
<p>The way to queue each type of complex analysis computation is described in the below sections. After computation takes place, each method will yield a selection of field(s) in a <code>ComplexResult</code> object matching the specified complex.</p>
<p>Each method below takes a complex specification as its first argument. This should be given as an ordered sequence of strands (e.g. <code>strands=['AAA', 'TTT']</code>) or as an equivalent plus-separated string (e.g. <code>'AAA+TTT'</code>). An additional parameter <code>max_size</code> is provided as well. If <code>max_size=0</code> (the default), only the complex matching the specified ordered strands will be computed. Otherwise, each complexes of up to <code>max_size</code> (inclusive) consisting of a subset of the specified strands in any order will be computed.</p>
<p>After queueing your desired computations, follow the directions in <a href="#computation">Computation</a>.</p>
<hr />
<h3 id="partition-function">Partition function<a class="headerlink" href="#partition-function" title="Permanent link">&para;</a></h3>
<p><strong>Example code:</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">strands</span> <span class="o">=</span> <span class="n">RawComplex</span><span class="p">(</span><span class="s1">&#39;AAAAU+UUU&#39;</span><span class="p">)</span>
<span class="n">spec</span><span class="o">.</span><span class="n">pfunc</span><span class="p">(</span><span class="n">strands</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<p><strong>Description:</strong> Schedule computation of the partition function, <span><span class="MathJax_Preview">Q(\phi)</span><script type="math/tex">Q(\phi)</script></span>, over the ensemble <span><span class="MathJax_Preview">\Gamma'</span><script type="math/tex">\Gamma'</script></span>. This computation will yield the output fields:</p>
<ul>
<li><code>pfunc</code></li>
<li><code>free_energy</code></li>
</ul>
<hr />
<h3 id="pair-probability">Pair probability<a class="headerlink" href="#pair-probability" title="Permanent link">&para;</a></h3>
<p><strong>Example code:</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">spec</span><span class="o">.</span><span class="n">pairs</span><span class="p">(</span><span class="n">strands</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>
<p><strong>Description:</strong> Schedule computation of <em>pair probabilities</em> <span><span class="MathJax_Preview">P_{i, j} \equiv p(i_n \cdot j_m)</span><script type="math/tex">P_{i, j} \equiv p(i_n \cdot j_m)</script></span> for the complex corresponding to the specified strand ordering <span><span class="MathJax_Preview">\pi</span><script type="math/tex">\pi</script></span>. The probability of an base being unpaired is on the matrix diagonal <span><span class="MathJax_Preview">P(i, i)</span><script type="math/tex">P(i, i)</script></span>. The specified matrix <span><span class="MathJax_Preview">P</span><script type="math/tex">P</script></span> is symmetric and satisfies <span><span class="MathJax_Preview">\sum_i P_{i, j} = 1</span><script type="math/tex">\sum_i P_{i, j} = 1</script></span>.</p>
<p>Analyze the equilibrium base-pairing properties of a complex of interacting nucleic acid strands. This computation will yield the output fields:</p>
<ul>
<li><code>pairs</code></li>
<li><code>pfunc</code></li>
<li><code>free_energy</code></li>
</ul>
<hr />
<h3 id="minimum-free-energy">Minimum free energy<a class="headerlink" href="#minimum-free-energy" title="Permanent link">&para;</a></h3>
<p><strong>Example code:</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">spec</span><span class="o">.</span><span class="n">mfe</span><span class="p">(</span><span class="n">strands</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">structures</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p><strong>Description:</strong> Schedule computation of the minimum free energy secondary structure(s), <span><span class="MathJax_Preview">s^\mathrm{MFE}(\phi)</span><script type="math/tex">s^\mathrm{MFE}(\phi)</script></span>, of sequence <span><span class="MathJax_Preview">\phi</span><script type="math/tex">\phi</script></span> over the ensemble of the complex, <span><span class="MathJax_Preview">\Gamma</span><script type="math/tex">\Gamma</script></span>. This computation will yield the output fields:</p>
<ul>
<li><code>mfe</code></li>
</ul>
<hr />
<h3 id="structure-count">Structure count<a class="headerlink" href="#structure-count" title="Permanent link">&para;</a></h3>
<p><strong>Example code:</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">spec</span><span class="o">.</span><span class="n">ensemble_size</span><span class="p">(</span><span class="n">strands</span><span class="p">)</span>
</code></pre></div>
<p><strong>Description:</strong> Schedule computation of the number of secondary structures, <span><span class="MathJax_Preview">|\Gamma|</span><script type="math/tex">|\Gamma|</script></span>, in the ensemble of the complex, treating all strands as distinct. This computation will yield the output fields:</p>
<ul>
<li><code>ensemble_size</code></li>
</ul>
<hr />
<h3 id="boltzmann-sampling">Boltzmann sampling<a class="headerlink" href="#boltzmann-sampling" title="Permanent link">&para;</a></h3>
<p><strong>Example code:</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">spec</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">strands</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
<p><strong>Description:</strong> Schedule computation of <code>number</code> random secondary structures sampled from the equilibrium Boltzmann distribution. This computation will yield the output fields:</p>
<ul>
<li><code>sample</code></li>
<li><code>free_energy</code></li>
<li><code>pfunc</code></li>
</ul>
<hr />
<h3 id="suboptimal-structures">Suboptimal structures<a class="headerlink" href="#suboptimal-structures" title="Permanent link">&para;</a></h3>
<p><strong>Example code:</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">spec</span><span class="o">.</span><span class="n">subopt</span><span class="p">(</span><span class="n">strands</span><span class="p">,</span> <span class="n">gap</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
</code></pre></div>
<p><strong>Description:</strong> Schedule computation of all secondary structures in <span><span class="MathJax_Preview">\Gamma</span><script type="math/tex">\Gamma</script></span> with free energies within the specified (non-negative) free energy gap of the MFE. This could produce an astronomical number of structures if the specified gap is too large. This computation will yield the output fields:</p>
<ul>
<li><code>subopt</code></li>
<li><code>mfe</code></li>
</ul>
<h2 id="computation">Computation<a class="headerlink" href="#computation" title="Permanent link">&para;</a></h2>
<p>After queueing the computations you want to run, run the following command to carry out all computation.</p>
<div class="highlight"><pre><span></span><code><span class="n">analysis_result</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</code></pre></div>
<p>You may specify the number of threads via the <code>threads</code> keyword and the maximum memory to use via the <code>cache_bytes</code> keyword. It is especially important on Linux systems not to set <code>cache_bytes</code> higher than your available RAM. The specification is in bytes, so <code>cache_bytes=4e9</code> is equivalent to a limit of 4 GB.</p>
<p><code>Specification.compute()</code> returns a <code>RawResult</code>. This class is a thin wrapper around a <code>dict</code> mapping a tuple of strands (e.g. <code>('AAAA', 'TTTT)</code>) to a result of type <code>ComplexResult</code>.</p>
<h2 id="outputs">Outputs<a class="headerlink" href="#outputs" title="Permanent link">&para;</a></h2>
<p>To retrieve a complex result for a desired complex of ordered strands, use the <code>[]</code> (<code>__getitem__</code>) method of <code>RawResult</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">complex_result</span> <span class="o">=</span> <span class="n">analysis_result</span><span class="p">[</span><span class="n">strands</span><span class="p">]</span>
</code></pre></div>
<p>A <code>ComplexResult</code> is just a <code>namedtuple</code> of computed results for the given complex. Specifically, an instance of <code>ComplexResult</code> has the following fields which may or may not be <code>None</code> (depending on if a matching computation was requested):</p>
<ul>
<li>
<p><code>pfunc</code>: the natural logarithm of the partition function. You can retrieve the partition function as <code>numpy.exp(complex_result.log_partition_function, dtype=numpy.float128)</code>, but be aware that this number may be too large to represent in a floating point format. The log partition function of an impossible complex is <span><span class="MathJax_Preview">-\infty</span><script type="math/tex">-\infty</script></span>.</p>
</li>
<li>
<p><code>free_energy</code>: the complex free energy in kcal/mol. The free energy of an impossible complex is <span><span class="MathJax_Preview">+\infty</span><script type="math/tex">+\infty</script></span>.</p>
</li>
<li>
<p><code>ensemble_size</code>: number of secondary structure or stacking states.</p>
</li>
<li>
<p><code>mfe</code>: a list of each <a href="#structure-type"><code>Structure</code></a> matching the minimum stacking state free energy.</p>
</li>
<li>
<p><code>pairs</code>: a <code>PairsMatrix</code> of shape (N, N) of the base pairing probabilities. <code>P[i, j]</code> is a <code>float</code> of the probability that bases of zero-based indices <code>i</code> and <code>j</code> are paired. The pair probabilities of an impossible complex are all set to 0.</p>
</li>
<li>
<p><code>sample</code>: a randomly ordered list of each <a href="#structure-type"><code>Structure</code></a> sampled from the equilibrium Boltzmann distribution. The structures yielded for an impossible complex are represented as pair lists with no base pairs.</p>
</li>
<li>
<p><code>subopt</code>: a list of each pair of a <a href="#structure-type"><code>Structure</code></a> and its respective free energy derived from the suboptimal structure algorithm with a specified free energy gap.</p>
</li>
</ul>
<hr />
<p>&lt;!&ndash;</p>
<h3 id="structure-probability">Structure probability<a class="headerlink" href="#structure-probability" title="Permanent link">&para;</a></h3>
<p>The equilibrium probability of complex <code>strands</code> being in the secondary structure <code>structure</code> is cheap to compute once the partition function is known. For this purpose, the following method of <code>RawResult</code> is provided.</p>
<div class="highlight"><pre><span></span><code><span class="n">prob</span> <span class="o">=</span> <span class="n">analysis_result</span><span class="o">.</span><span class="n">structure_probability</span><span class="p">(</span><span class="n">strands</span><span class="p">,</span> <span class="n">structure</span><span class="p">)</span> <span class="c1"># yields a float between 0 and 1</span>
<span class="err">```</span> <span class="o">--&gt;</span>

<span class="c1">## Concentration solving</span>

<span class="n">Test</span> <span class="n">tube</span> <span class="n">analysis</span> <span class="n">enables</span> <span class="n">prediction</span> <span class="n">of</span> <span class="n">equilibrium</span> <span class="n">concentrations</span> <span class="ow">and</span> <span class="n">related</span> <span class="n">quantities</span> <span class="k">for</span> <span class="n">an</span> <span class="n">ensemble</span> <span class="n">of</span> <span class="n">strands</span> <span class="n">at</span> <span class="n">user</span><span class="o">-</span><span class="n">specified</span> <span class="n">concentrations</span><span class="o">.</span>

<span class="o">---</span>

<span class="c1">### Specification</span>

<span class="n">Create</span> <span class="n">an</span> <span class="n">instance</span> <span class="n">of</span> <span class="err">`</span><span class="n">nupack</span><span class="o">.</span><span class="n">ConcentrationSolver</span><span class="err">`</span> <span class="n">using</span> <span class="n">an</span> <span class="n">iterable</span> <span class="n">of</span> <span class="n">strands</span> <span class="ow">and</span> <span class="n">a</span> <span class="err">`</span><span class="n">nupack</span><span class="o">.</span><span class="n">RawResult</span><span class="err">`</span><span class="o">.</span> <span class="n">All</span> <span class="n">partition</span> <span class="n">function</span> <span class="n">information</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">previously</span> <span class="n">calculated</span> <span class="nb">complex</span> <span class="n">results</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">by</span> <span class="n">default</span><span class="o">.</span> <span class="n">You</span> <span class="n">must</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">that</span> <span class="n">analysis</span> <span class="n">was</span> <span class="n">carried</span> <span class="n">out</span> <span class="n">on</span> <span class="nb">all</span> <span class="n">complexes</span> <span class="n">that</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">include</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">test</span> <span class="n">tube</span> <span class="n">ensemble</span><span class="o">.</span>

<span class="err">```</span><span class="n">python</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">ConcentrationSolver</span><span class="p">(</span><span class="n">strands</span><span class="p">,</span> <span class="n">analysis_result</span><span class="p">,</span> <span class="n">distinguishable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<hr />
<h3 id="computation_1">Computation<a class="headerlink" href="#computation_1" title="Permanent link">&para;</a></h3>
<p>Given a user-specified concentration for each strand species (in moles per liter), calculate the equilibrium concentration of each complex species or base pair in a dilute solution (e.g., a test tube) [<a class="citation" href="#ref-Dirks07" id="cite-Dirks07">Dirks07</a>]. This calculation is typically quick compared to the dynamic programming algorithms used in <a href="#complex-analysis">Complex analysis</a>.</p>
<div class="highlight"><pre><span></span><code><span class="n">solver_result</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">compute</span><span class="p">([</span><span class="mf">1e-8</span><span class="p">,</span> <span class="mf">1e-7</span><span class="p">])</span>
<span class="n">concentration_result</span> <span class="o">=</span> <span class="n">solver_result</span><span class="o">.</span><span class="n">complex_concentrations</span>
</code></pre></div>
<p>The output <code>concentration_result</code> is a <code>dict</code> which maps from a <code>tuple</code> of strands to a complex concentration in moles per liter. You can repeatedly invoke the solver with different strand concentrations.</p>
<p>You may alternatively view your output using the <code>complexes</code> and <code>concentrations</code> fields of the solver result:</p>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">solver_result</span><span class="o">.</span><span class="n">complexes</span><span class="p">)</span> <span class="c1"># prints a list of tuples of integers</span>
<span class="nb">print</span><span class="p">(</span><span class="n">solver_result</span><span class="o">.</span><span class="n">concentrations</span><span class="p">)</span> <span class="c1"># prints a numpy.ndarray of equal length</span>
</code></pre></div>
<p>Each item in <code>complexes</code> is a tuple of strand indices denoting a single complex. (The indices match those which were used to construct the <code>ConcentrationSolver</code>). Each item in <code>concentrations</code> is the concentration of the matching complex. Using this API is only recommended if you are interested in distinguishing between strands of identical sequences.</p>
<p>To restrict your test tube ensemble to only a subset of calculated complexes, <code>compute()</code> accepts an additional keyword <code>complexes</code>. If given, <code>complexes</code> should be an integer, in which case only complexes up to this maximum size will be incorporated, or a list of complexes to incorporate with each complex specified as a tuple of strand sequences.</p>
<p>For generic equilibrium concentration determination in any system of interacting particles, you may use the <code>nupack.concentration.solve_equilibrium()</code> function.</p>
<hr />
<h2 id="citations">Citations<a class="headerlink" href="#citations" title="Permanent link">&para;</a></h2>
<div class="references">
<table>
<tbody>
<tr id="ref-Dirks07">
<td>Dirks07</td>
<td><p>Dirks R.M., Bois J.S., Schaeffer J.M., Winfree E., Pierce N.A.: <i>Thermodynamic Analysis of Interacting Nucleic Acid Strands</i>. SIAM Rev., <b>49</b>, (2007)</p></td>
</tr>
</tbody>
</table>
</div>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
